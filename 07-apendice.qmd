# Apéndice

## Cantidad de casos por país

```{r, echo=FALSE, warning=FALSE, message=FALSE}
pacman::p_load(here, lme4, dplyr, kableExtra)
load(here("Input", "Proc", "LAPOP_Final.RData"))

# Renombrar variables
lapop = lapop %>% 
  mutate(Redistribution = redistribution,
         Income = decile,
         Male = male_f,
         Age = age, 
         Political = ideology_f, 
         Left = left, 
         SystemConfidence = sysconf, 
         Education = education_r, 
         Income_Decile = decile_f, 
         GINI = gini,
         GDP = gdp,
         GINI_BE = gini_mean, 
         GINI_WE = gini_dif, 
         GDP_BE = gdp_mean, 
         GDP_WE = gdp_dif,
         Welfare = welfare,
         Country = countryname,
         CountryWave = country_wave,
         Year = year,
         Decile_d10 = decile_d10,
         Decile_d1 = decile_d1,
         Income2 = Income * Income,
         Corrupcion = corruption) %>%
  mutate(across(where(haven::is.labelled), as.numeric))

tabla_casos <- lapop %>%
  group_by(country, year) %>%
  summarise(cantidad_casos = n()) %>%
  arrange(country, year)

tabla_casos <- tabla_casos %>%
  mutate(country = recode(country,
                          "MEX" = "México",
                          "GTM" = "Guatemala",
                          "SLV" = "El Salvador",
                          "HND" = "Honduras",
                          "NIC" = "Nicaragua",
                          "CRI" = "Costa Rica",
                          "PAN" = "Panamá",
                          "COL" = "Colombia",
                          "ECU" = "Ecuador",
                          "BOL" = "Bolivia",
                          "PER" = "Perú",
                          "PRY" = "Paraguay",
                          "CHL" = "Chile",
                          "URY" = "Uruguay",
                          "BRA" = "Brasil",
                          "VEN" = "Venezuela",
                          "ARG" = "Argentina",
                          "DOM" = "República Dominicana"))

# Mostrar la tabla para PDF
tabla_casos %>%
  arrange(country, year) %>%  # Ordenar por país y año
  kable("latex", booktabs = TRUE, longtable = TRUE, col.names = c("País", "Año", "Cantidad de Casos")) %>%
  kable_styling(latex_options = c("hold_position", "repeat_header")) %>%
  collapse_rows(columns = 1, valign = "middle")
```

## Tabla de regresión multinivel

```{r multilevel, echo=FALSE, results='asis'}
#| label: tbl-multilevel

# Model 1. Only income
model_1 = lmer(Redistribution ~ 1 + Income
                + Year + (1 | CountryWave) 
                + (1 | Country), data=lapop, weights=wt)

# Model 2. Individual predictors 
model_2 = lmer(Redistribution ~ 1 + Income + Male + Age  
                + Political + SystemConfidence + Education 
                + Year + (1 | CountryWave) + (1 | Country), data=lapop, weights=wt)

# Model 3. Individual predictors + GINI  + GDP
model_3 = lmer(Redistribution ~ 1 + Income + Male + Age 
                + Political + SystemConfidence + Education 
                + GINI
                + GDP + Year
                + (1 | CountryWave) + (1 | Country), data=lapop, weights=wt)

# Model 4. Individual predictors + GINI + GDP (Income)
model_4 = lmer(Redistribution ~ 1 + Income + Male + Age 
                + Political + SystemConfidence + Education 
                + GINI
                + GDP + Year
                + Corrupcion
                + (1 | CountryWave) + (1 | Country), data=lapop, weights=wt)

# Table 1: individual

texreg::texreg(
  list(model_1, model_2, model_3, model_4),
  digits = 3,
  custom.note = "*** p < 0.001; ** p < 0.01; * p < 0.05.",
  custom.coef.names = c("Intercepto",
                        "Ingreso",
                        "Año 2010",
                        "Año 2012",
                        "Año 2014",
                        "Año 2016",
                        "Año 2018",
                        "Año 2023",
                        "Hombre \\textit{(Ref. Mujer)}",
                        "Edad",
                        "Centro",
                        "Izquierda",
                        "No se identifica",
                        "Confianza en instituciones",
                        "Secundaria",
                        "Terciaria",
                        "GINI",
                        "GDP",
                        "Corrupción"),
  groups = list("Año (Ref.= Año 2008)" = 3:8,
                "Identificación política (Ref.= Derecha)" = 11:13,
                "Educación (Ref.= Primaria)" = 15:16),
  include.loglik = FALSE,
  include.aic = FALSE,
  custom.gof.names = c("BIC",
                       "Num. obs.",
                       "Num. groups: Año-país",
                       "Num. groups: País",
                       "Var: año-país (Intercepto)",
                       "Var: país (Intercepto)",
                       "Var: Residual"),
  center = TRUE,
  caption.above = TRUE,
  caption = "Tabla de regresión multinivel longitudinal",
  scalebox = 0.9,  # Ajuste del tamaño de la tabla
  booktabs = TRUE,  # Mejor formato para las tablas
  use.packages = FALSE,
  include.rs = FALSE, 
  include.rmse = FALSE,
  include.ci = FALSE
)

```
